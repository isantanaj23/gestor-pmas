# ğŸ” Script de verificaciÃ³n completa post-recuperaciÃ³n
# Ejecutar en PowerShell desde la carpeta client

Write-Host "ğŸ” Verificando estado del proyecto despuÃ©s de la recuperaciÃ³n..." -ForegroundColor Cyan

# ============================================================================
# VERIFICACIÃ“N 1: Archivos esenciales
# ============================================================================

Write-Host "`nğŸ“ Verificando archivos esenciales..." -ForegroundColor Yellow

$essential_files = @(
    "package.json",
    "package-lock.json", 
    "src/index.js",
    "src/App.js",
    "public/index.html"
)

foreach ($file in $essential_files) {
    if (Test-Path $file) {
        Write-Host "âœ… $file" -ForegroundColor Green
    } else {
        Write-Host "âŒ $file - FALTA" -ForegroundColor Red
    }
}

# ============================================================================
# VERIFICACIÃ“N 2: node_modules restaurado
# ============================================================================

Write-Host "`nğŸ“¦ Verificando node_modules..." -ForegroundColor Yellow

if (Test-Path "node_modules") {
    $node_modules_size = (Get-ChildItem "node_modules" -Recurse | Measure-Object -Property Length -Sum).Sum / 1MB
    Write-Host "âœ… node_modules restaurado (~$([math]::Round($node_modules_size, 0)) MB)" -ForegroundColor Green
} else {
    Write-Host "âŒ node_modules no existe - Ejecutar: npm install" -ForegroundColor Red
}

# ============================================================================
# VERIFICACIÃ“N 3: Dependencias especÃ­ficas para notificaciones
# ============================================================================

Write-Host "`nğŸ”” Verificando dependencias de notificaciones..." -ForegroundColor Yellow

$notification_deps = @(
    "react-hot-toast",
    "socket.io-client", 
    "@headlessui/react",
    "axios",
    "date-fns"
)

foreach ($dep in $notification_deps) {
    try {
        $result = npm list $dep 2>$null
        if ($LASTEXITCODE -eq 0) {
            Write-Host "âœ… $dep" -ForegroundColor Green
        } else {
            Write-Host "âŒ $dep - FALTA" -ForegroundColor Red
            Write-Host "   Ejecutar: npm install $dep" -ForegroundColor Gray
        }
    } catch {
        Write-Host "âŒ $dep - ERROR verificando" -ForegroundColor Red
    }
}

# ============================================================================
# VERIFICACIÃ“N 4: Archivos de componentes de notificaciones
# ============================================================================

Write-Host "`nğŸ¨ Verificando componentes de notificaciones..." -ForegroundColor Yellow

$component_files = @(
    "src/hooks/useNotifications.js",
    "src/hooks/usePushNotifications.js",
    "src/components/notifications/ToastNotification.js",
    "src/components/notifications/NotificationCenter.js",
    "src/components/notifications/NotificationBell.js"
)

foreach ($file in $component_files) {
    if (Test-Path $file) {
        Write-Host "âœ… $file" -ForegroundColor Green
    } else {
        Write-Host "âš ï¸  $file - PENDIENTE CREAR" -ForegroundColor Yellow
    }
}

# ============================================================================
# VERIFICACIÃ“N 5: Scripts disponibles
# ============================================================================

Write-Host "`nğŸ”§ Verificando scripts de package.json..." -ForegroundColor Yellow

try {
    $package = Get-Content "package.json" | ConvertFrom-Json
    $scripts = $package.scripts
    
    if ($scripts.start) {
        Write-Host "âœ… npm start disponible" -ForegroundColor Green
    } else {
        Write-Host "âŒ npm start no configurado" -ForegroundColor Red
    }
    
    if ($scripts.build) {
        Write-Host "âœ… npm run build disponible" -ForegroundColor Green
    } else {
        Write-Host "âŒ npm run build no configurado" -ForegroundColor Red
    }
    
} catch {
    Write-Host "âŒ Error leyendo package.json" -ForegroundColor Red
}

# ============================================================================
# VERIFICACIÃ“N 6: Versiones de herramientas
# ============================================================================

Write-Host "`nğŸ”§ Verificando versiones de herramientas..." -ForegroundColor Yellow

Write-Host "Node.js: " -NoNewline -ForegroundColor Gray
try {
    $nodeVersion = node --version
    Write-Host $nodeVersion -ForegroundColor Green
} catch {
    Write-Host "ERROR - Node.js no encontrado" -ForegroundColor Red
}

Write-Host "npm: " -NoNewline -ForegroundColor Gray
try {
    $npmVersion = npm --version
    Write-Host $npmVersion -ForegroundColor Green
} catch {
    Write-Host "ERROR - npm no encontrado" -ForegroundColor Red
}

# ============================================================================
# PRUEBA DE COMPILACIÃ“N
# ============================================================================

Write-Host "`nğŸ§ª Probando compilaciÃ³n..." -ForegroundColor Yellow

try {
    Write-Host "Ejecutando: npm run build --dry-run..." -ForegroundColor Gray
    
    # Verificar si podemos al menos validar la configuraciÃ³n
    $env:CI = "true"  # Evitar que se abra el navegador
    
    # Test bÃ¡sico de sintaxis
    Write-Host "Verificando sintaxis bÃ¡sica..." -ForegroundColor Gray
    
    if (Test-Path "src/index.js") {
        $content = Get-Content "src/index.js" -Raw
        if ($content -like "*import*React*") {
            Write-Host "âœ… src/index.js parece vÃ¡lido" -ForegroundColor Green
        } else {
            Write-Host "âš ï¸  src/index.js puede tener problemas" -ForegroundColor Yellow
        }
    }
    
} catch {
    Write-Host "âš ï¸  No se pudo probar la compilaciÃ³n" -ForegroundColor Yellow
}

# ============================================================================
# RESUMEN Y PRÃ“XIMOS PASOS
# ============================================================================

Write-Host "`nğŸ“‹ RESUMEN DE VERIFICACIÃ“N" -ForegroundColor Magenta
Write-Host "=========================" -ForegroundColor Magenta

Write-Host "`nğŸ¯ PRÃ“XIMOS PASOS RECOMENDADOS:" -ForegroundColor Cyan

if (!(Test-Path "node_modules")) {
    Write-Host "1. ğŸ”¥ URGENTE: Ejecutar 'npm install'" -ForegroundColor Red
}

$missing_deps = @()
foreach ($dep in $notification_deps) {
    try {
        npm list $dep 2>$null | Out-Null
        if ($LASTEXITCODE -ne 0) {
            $missing_deps += $dep
        }
    } catch {
        $missing_deps += $dep
    }
}

if ($missing_deps.Count -gt 0) {
    Write-Host "2. ğŸ“¦ Instalar dependencias faltantes:" -ForegroundColor Yellow
    Write-Host "   npm install $($missing_deps -join ' ')" -ForegroundColor Gray
}

$missing_components = @()
foreach ($file in $component_files) {
    if (!(Test-Path $file)) {
        $missing_components += $file
    }
}

if ($missing_components.Count -gt 0) {
    Write-Host "3. ğŸ“ Crear archivos de componentes faltantes:" -ForegroundColor Yellow
    foreach ($comp in $missing_components) {
        Write-Host "   - $comp" -ForegroundColor Gray
    }
}

Write-Host "4. ğŸ§ª Probar: npm start" -ForegroundColor Yellow
Write-Host "5. ğŸŒ Verificar que abra en http://localhost:3000" -ForegroundColor Yellow

Write-Host "`nâœ… VerificaciÃ³n completada" -ForegroundColor Green
Write-Host "Si todos los elementos estÃ¡n en verde, puedes intentar 'npm start'" -ForegroundColor Gray

Read-Host "`nPresiona Enter para continuar"